<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>I.T.P.L.E - Plataforma educativa</title>
<style>
:root{
  --blue:#1a73e8;
  --blue-dark:#155ab6;
  --bg:#f4f7fa;
  --card:#fff;
  --danger:#d32f2f;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:var(--bg);
  color:#222;
}
/* header/footer */
.site-header{
  background:var(--blue);
  color:#fff;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.brand{font-weight:700;font-size:18px}
.header-role{font-size:14px;opacity:.95}
.site-footer{
  background:var(--blue);
  color:#fff;
  padding:10px 20px;
  text-align:center;
  position:fixed;
  bottom:0;
  width:100%;
}

/* layout */
.layout{display:flex;min-height:calc(100vh - 86px);}
.sidebar{
  width:240px;
  background:var(--blue);
  color:#fff;
  padding:18px;
}
.sidebar h3{margin-top:0;text-align:center}
.menu-list, .sidebar ul{list-style:none;padding:0;margin:0}
.menu-list li, .sidebar ul li{
  background:rgba(255,255,255,0.06);
  margin:8px 0;
  padding:10px;
  border-radius:6px;
  cursor:pointer;
  transition:background .15s;
  text-align:center;
}
.menu-list li:hover, .sidebar ul li:hover{background:rgba(255,255,255,0.12)}
.sidebar-footer{margin-top:18px}

/* main */
.main{flex:1;padding:24px;background:var(--bg)}
.card, .center-box{background:var(--card);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
.center-box{display:flex;align-items:center;justify-content:center;height:100vh;padding:20px}
.card{padding:20px;max-width:920px;width:100%;text-align:center;margin:auto}
h2{color:var(--blue);margin:8px 0}
.muted{color:#666;font-size:14px;margin-bottom:10px}
input, select, textarea{
  width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #d0d7de;font-size:14px;
}
textarea{min-height:96px;resize:vertical}
.btn{display:inline-block;padding:10px 14px;background:var(--blue);color:#fff;border:none;border-radius:6px;cursor:pointer}
.btn:hover{background:var(--blue-dark)}
.btn.small{padding:6px 8px;font-size:13px}
.danger{background:var(--danger)}
.danger:hover{background:#a30000}
.error{color:#c62828;margin-top:8px}

/* lists */
.list-card{background:#fff;padding:12px;border-radius:8px;margin-bottom:12px}
.row{display:flex;gap:12px;align-items:center}
.col{flex:1}
.meta{font-size:13px;color:#666;margin-top:6px}
.tag{display:inline-block;padding:4px 8px;border-radius:12px;background:#eaf3ff;color:var(--blue);font-size:12px}

/* small helpers */
.small{font-size:13px;color:#555}
center{display:block;text-align:center}

/* active menu item */
.sidebar ul li.active{background:rgba(255,255,255,0.22)}

/* login specific */
.login-center{display:flex;align-items:center;justify-content:center;height:calc(100vh - 40px)}
.login-card{width:420px;padding:24px}
.help{font-size:13px;color:#666;margin-top:12px}
</style>
</head>
<body>

<!-- index.html: Single-file educational platform -->
<header class="site-header">
  <div class="brand">I.T.P.L.E 2017</div>
  <div id="headerRole" class="header-role"></div>
</header>

<main id="appRoot">
  <!-- Login view -->
  <div id="loginView" class="login-center">
    <div class="card login-card">
      <h2>I.T.P.L.E - Plataforma educativa</h2>
      <p class="muted">Inicia sesión como Profesor o Estudiante</p>
      <select id="role"><option value="" disabled selected>Seleccione Usuario</option><option value="estudiante">Estudiante</option><option value="profesor">Profesor</option></select>
      <input id="username" placeholder="Usuario (itple)"/>
      <input id="password" type="password" placeholder="Contraseña (2017 / ple2017)"/>
      <button class="btn" onclick="login()">Ingresar</button>
      <p id="loginError" class="error"></p>
      <p class="help">Prueba: estudiante -> itple / 2017  •  profesor -> itple / ple2017</p>
    </div>
  </div>

  <!-- App layout (hidden until login) -->
  <div id="appLayout" style="display:none;">
    <div class="layout">
      <aside class="sidebar">
        <h3 id="welcomeTitle">Bienvenido</h3>
        <ul id="menuList" class="menu-list"></ul>
        <div class="sidebar-footer">
          <button class="btn danger" onclick="logout()">Cerrar sesión</button>
        </div>
      </aside>

      <section class="main" id="mainContent">
        <section id="homeView">
          <h2>Panel</h2>
          <p>Seleccione una opción del menú.</p>
          <div id="quickInfo"></div>
        </section>
      </section>
    </div>
  </div>
</main>

<footer class="site-footer">© I.T.P.L.E 2017</footer>

<script>
// -----------------------------
// Lightweight single-file platform JS
// -----------------------------
const uid = ()=> Date.now().toString(36) + Math.random().toString(36).slice(2,7);

// Initialize data from localStorage
let estudiantes = JSON.parse(localStorage.getItem('estudiantes')) || [
  {id: uid(), name: "Juan Pérez"},
  {id: uid(), name: "María López"},
  {id: uid(), name: "Carlos Gómez"}
];
let tareas = JSON.parse(localStorage.getItem('tareas')) || []; // tasks with submissions
let notifications = JSON.parse(localStorage.getItem('notifications')) || [];

// Save
function saveAll(){ localStorage.setItem('estudiantes', JSON.stringify(estudiantes)); localStorage.setItem('tareas', JSON.stringify(tareas)); localStorage.setItem('notifications', JSON.stringify(notifications)); }

// Login
function login(){
  const role = document.getElementById('role').value;
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  const err = document.getElementById('loginError');
  err.textContent = '';
  if(!role){ err.textContent = 'Seleccione usuario'; return; }
  if(role==='estudiante' && user==='itple' && pass==='2017'){
    sessionStorage.setItem('role','estudiante');
    // choose first student by default if not set
    if(!sessionStorage.getItem('studentId')) sessionStorage.setItem('studentId', estudiantes[0].id);
    openApp();
  } else if(role==='profesor' && user==='itple' && pass==='ple2017'){
    sessionStorage.setItem('role','profesor');
    openApp();
  } else { err.textContent = 'Credenciales incorrectas'; }
}

// Logout
function logout(){ sessionStorage.clear(); location.reload(); }

// Open app layout
function openApp(){
  document.getElementById('loginView').style.display='none';
  document.getElementById('appLayout').style.display='block';
  pageInit();
}

// Page initialization (build menu and welcome)
function pageInit(){
  const role = sessionStorage.getItem('role');
  if(!role){ location.reload(); return; }
  document.getElementById('headerRole').textContent = role.toUpperCase();
  document.getElementById('welcomeTitle').textContent = (role.charAt(0).toUpperCase()+role.slice(1));

  const menu = document.getElementById('menuList'); menu.innerHTML='';
  const items = role==='profesor' ? ['Dashboard','Estudiantes','Tareas','Notas','Notificaciones'] : ['Dashboard','Tareas','Notas','Notificaciones','Boletín'];
  items.forEach(it=>{
    const li = document.createElement('li'); li.textContent = it;
    li.onclick = ()=>{ Array.from(menu.children).forEach(c=>c.classList.remove('active')); li.classList.add('active'); handleMenu(it, role); };
    if(it==='Dashboard') li.classList.add('active');
    menu.appendChild(li);
  });
  renderDashboardQuick();
}

// Dashboard quick info
function renderDashboardQuick(){
  const qi = document.getElementById('quickInfo');
  if(!qi) return;
  const totalStudents = estudiantes.length;
  const totalTasks = tareas.length;
  const pending = tareas.reduce((a,t)=> a + t.submissions.filter(s=> s.grade===undefined ).length, 0);
  qi.innerHTML = `<div class="list-card"><div class="row"><div class="col"><strong>Estudiantes</strong><div class="meta">${totalStudents}</div></div><div class="col"><strong>Tareas</strong><div class="meta">${totalTasks}</div></div><div class="col"><strong>Entregas pendientes</strong><div class="meta">${pending}</div></div></div></div>`;
}

// Menu handler
function handleMenu(item, role){
  if(item==='Dashboard'){ document.getElementById('mainContent').innerHTML = document.getElementById('homeView').outerHTML; renderDashboardQuick(); return; }
  if(item==='Estudiantes'){ renderStudents(); return; }
  if(item==='Tareas'){ renderTasks(role); return; }
  if(item==='Notas'){ renderGrades(role); return; }
  if(item==='Notificaciones'){ renderNotifications(role); return; }
  if(item==='Boletín'){ renderBoletin(); return; }
}

// Students (professor)
function renderStudents(){
  const main = document.getElementById('mainContent');
  main.innerHTML = `<h2>Estudiantes</h2><div id="studentsList"></div><div class="list-card"><h4>Agregar Estudiante</h4><input id="newStudentName" placeholder="Nombre completo"/><button class="btn small" onclick="addStudent()">Agregar</button></div>`;
  refreshStudentsList();
}
function refreshStudentsList(){ const c=document.getElementById('studentsList'); c.innerHTML = estudiantes.map(s=>`<div class="list-card"><div class="row"><div class="col"><strong>${s.name}</strong><div class="meta">ID: ${s.id}</div></div><div><button class="btn small" onclick="removeStudent('${s.id}')">Eliminar</button></div></div></div>`).join('');}
function addStudent(){ const name=document.getElementById('newStudentName').value.trim(); if(!name){alert('Escribe un nombre');return;} estudiantes.push({id:uid(),name}); saveAll(); document.getElementById('newStudentName').value=''; refreshStudentsList(); }
function removeStudent(id){ if(!confirm('Eliminar estudiante?')) return; estudiantes = estudiantes.filter(s=>s.id!==id); tareas.forEach(t=> t.submissions = t.submissions.filter(sub=> sub.studentId !== id)); saveAll(); refreshStudentsList(); }

// Tasks (create, view, submit)
function renderTasks(role){
  const main = document.getElementById('mainContent');
  if(role==='profesor'){
    main.innerHTML = `<h2>Tareas (Profesor)</h2><div class="list-card"><h4>Crear Tarea</h4><input id="taskTitle" placeholder="Título"/><textarea id="taskDesc" placeholder="Descripción"></textarea><button class="btn small" onclick="createTask()">Crear y asignar</button></div><div id="tasksList"></div>`;
    refreshTasksProf();
  } else {
    main.innerHTML = `<h2>Tareas (Estudiante)</h2><div id="studentTaskList"></div>`;
    refreshTasksStudent();
  }
}
function createTask(){ const title=document.getElementById('taskTitle').value.trim(); const desc=document.getElementById('taskDesc').value.trim(); if(!title){alert('Título requerido');return;} tareas.unshift({id:uid(),title,description:desc,createdAt:new Date().toISOString(),submissions:[]}); saveAll(); document.getElementById('taskTitle').value=''; document.getElementById('taskDesc').value=''; refreshTasksProf(); }
function refreshTasksProf(){ const c=document.getElementById('tasksList'); if(!c) return; c.innerHTML = tareas.length===0?'<p>No hay tareas.</p>': tareas.map(t=>`<div class="list-card"><strong>${t.title}</strong><div class="meta">${t.description||''}</div><div class="meta">Creada: ${new Date(t.createdAt).toLocaleString()}</div><div class="meta">Entregas: ${t.submissions.length}</div><div style="margin-top:8px"><button class="btn small" onclick="viewSubmissions('${t.id}')">Ver entregas</button> <button class="btn small" onclick="deleteTask('${t.id}')">Eliminar</button></div></div>`).join('');}
function deleteTask(id){ if(!confirm('Eliminar tarea?')) return; tareas = tareas.filter(t=>t.id!==id); saveAll(); refreshTasksProf(); }

function viewSubmissions(taskId){
  const task = tareas.find(t=>t.id===taskId);
  if(!task) return alert('No encontrada');
  const main=document.getElementById('mainContent'); main.innerHTML=`<h2>Entregas: ${task.title}</h2><div id="subsList"></div><div style="margin-top:12px"><button class="btn small" onclick="renderTasks(\'profesor\')">Volver</button></div>`;
  const subs=document.getElementById('subsList');
  subs.innerHTML = task.submissions.length===0?'<p>No hay entregas.</p>': task.submissions.map(s=>`<div class="list-card"><div class="row"><div class="col"><strong>${s.studentName}</strong><div class="meta">Enviado: ${new Date(s.submittedAt).toLocaleString()}</div><div class="meta">Archivo: ${s.fileName||'(sin archivo)'} ${s.text?'<div class="meta">Texto entregado</div>':''}</div><div class="meta">Nota: ${s.grade!==undefined? s.grade : 'Sin calificar'}</div><div class="meta small">Obs: ${s.gradeNote||''}</div></div><div style="min-width:160px;text-align:right">${s.dataURL?`<a href="${s.dataURL}" download="${s.fileName}" class="btn small">Descargar</a>`:''}<button class="btn small" onclick="openGrade('${taskId}','${s.id}')">Calificar</button> <button class="btn small" onclick="removeSubmission('${taskId}','${s.id}')">Eliminar</button></div></div></div>`).join('');
}
function removeSubmission(taskId,subId){ if(!confirm('Eliminar entrega?')) return; const task=tareas.find(t=>t.id===taskId); task.submissions = task.submissions.filter(s=>s.id!==subId); saveAll(); viewSubmissions(taskId); }
function openGrade(taskId,subId){ const task=tareas.find(t=>t.id===taskId); const s=task.submissions.find(x=>x.id===subId); const main=document.getElementById('mainContent'); main.innerHTML=`<h3>Calificar ${s.studentName}</h3><div class="list-card"><input id="gradeVal" placeholder="Nota (ej:8.5)"/><input id="gradeNote" placeholder="Observación"/><button class="btn small" onclick="saveGrade('${taskId}','${subId}')">Guardar</button><button class="btn small" onclick="viewSubmissions('${taskId}')">Cancelar</button></div>`; }
function saveGrade(taskId,subId){ const grade=document.getElementById('gradeVal').value.trim(); const note=document.getElementById('gradeNote').value.trim(); if(!grade){alert('Ingrese nota');return;} const task=tareas.find(t=>t.id===taskId); const sub=task.submissions.find(s=>s.id===subId); sub.grade=grade; sub.gradeNote=note; saveAll(); alert('Nota guardada'); viewSubmissions(taskId); }

// Student functions
function refreshTasksStudent(){
  const container=document.getElementById('studentTaskList'); if(!container) return;
  const studentId=sessionStorage.getItem('studentId') || (estudiantes[0] && estudiantes[0].id);
  if(tareas.length===0) container.innerHTML='<p>No hay tareas asignadas.</p>'; else container.innerHTML = tareas.map(t=>{ const sub=t.submissions.find(s=>s.studentId===studentId); return `<div class="list-card"><strong>${t.title}</strong><div class="meta">${t.description||''}</div><div class="meta">Creada: ${new Date(t.createdAt).toLocaleString()}</div><div class="meta">Estado: ${sub? (sub.grade?('Calificada: '+sub.grade):'Entregada') : 'Pendiente'}</div><div style="margin-top:8px">${sub? `<button class="btn small" onclick="viewMy('${t.id}')">Ver mi entrega</button>`: `<button class="btn small" onclick="openSubmit('${t.id}')">Entregar</button>`}</div></div>`; }).join('');
}
function openSubmit(taskId){ const task=tareas.find(t=>t.id===taskId); const main=document.getElementById('mainContent'); main.innerHTML=`<h3>Entregar: ${task.title}</h3><div class="list-card"><p class="meta">${task.description||''}</p><input type="file" id="fileIn"/><textarea id="deliverText" placeholder="Texto (opcional)"></textarea><button class="btn small" onclick="submitTask('${taskId}')">Enviar</button><button class="btn small" onclick="handleMenu('Tareas', 'estudiante')">Cancelar</button></div>`; }
function submitTask(taskId){ const fileIn=document.getElementById('fileIn'); const text=document.getElementById('deliverText').value.trim(); const studentId=sessionStorage.getItem('studentId') || estudiantes[0].id; const studentName=estudiantes.find(s=>s.id===studentId).name; const file=fileIn.files && fileIn.files[0]; if(!file && !text) return alert('Adjunte o escriba algo'); if(file){ const r=new FileReader(); r.onload=function(e){ saveSubmission(taskId, studentId, studentName, file.name, e.target.result, text); handleMenu('Tareas','estudiante'); }; r.readAsDataURL(file); } else { saveSubmission(taskId, studentId, studentName, null, null, text); handleMenu('Tareas','estudiante'); } }
function saveSubmission(taskId, studentId, studentName, fileName, dataURL, text){ const task=tareas.find(t=>t.id===taskId); const sub={id:uid(),studentId,studentName,fileName,dataURL,text,submittedAt:new Date().toISOString(),grade:undefined,gradeNote:''}; task.submissions = task.submissions.filter(s=>s.studentId!==studentId); task.submissions.push(sub); saveAll(); alert('Entrega enviada'); }
function viewMy(taskId){ const studentId=sessionStorage.getItem('studentId') || estudiantes[0].id; const task=tareas.find(t=>t.id===taskId); const sub=task.submissions.find(s=>s.studentId===studentId); const main=document.getElementById('mainContent'); if(!sub) return alert('No hay entrega'); main.innerHTML=`<h3>Mi entrega: ${task.title}</h3><div class="list-card"><div class="meta">Enviado: ${new Date(sub.submittedAt).toLocaleString()}</div><div class="meta">Archivo: ${sub.fileName || '(sin archivo)'}</div>${sub.dataURL? `<a href="${sub.dataURL}" download="${sub.fileName}" class="btn small">Descargar</a>`:''}<div class="meta">Texto: ${sub.text? '<pre style="white-space:pre-wrap;">'+escapeHtml(sub.text)+'</pre>':'(sin texto)'}</div><div class="meta">Nota: ${sub.grade!==undefined?sub.grade:'Sin calificar'}</div><div style="margin-top:10px"><button class="btn small" onclick="handleMenu('Tareas', sessionStorage.getItem('role'))">Volver</button></div></div>`; }

// Grades view
function renderGrades(role){
  const main=document.getElementById('mainContent');
  if(role==='profesor'){
    main.innerHTML='<h2>Notas (Profesor)</h2><div id="gradesList"></div>'; const gl=document.getElementById('gradesList'); if(tareas.length===0) gl.innerHTML='<p>No hay tareas.</p>'; else gl.innerHTML=tareas.map(t=>`<div class="list-card"><strong>${t.title}</strong><div class="meta">${t.description||''}</div><div style="margin-top:8px"><button class="btn small" onclick="viewSubmissions('${t.id}')">Ver entregas / Calificar</button></div></div>`).join('');
  } else {
    const studentId=sessionStorage.getItem('studentId') || estudiantes[0].id; main.innerHTML='<h2>Mis Notas</h2><div id="myGrades"></div>'; const cont=document.getElementById('myGrades'); const items=tareas.map(t=>{ const s=t.submissions.find(x=>x.studentId===studentId); return {task:t,sub:s}; }); if(items.length===0) cont.innerHTML='<p>No hay calificaciones.</p>'; else cont.innerHTML=items.map(it=>`<div class="list-card"><strong>${it.task.title}</strong><div class="meta">Nota: ${it.sub? (it.sub.grade!==undefined?it.sub.grade:'Sin calificar'):'Sin entrega'}</div><div class="meta">Obs: ${it.sub? (it.sub.gradeNote || '-') : '-'}</div></div>`).join('');
  }
}

// Notifications
function renderNotifications(role){
  const main=document.getElementById('mainContent');
  if(role==='profesor'){ main.innerHTML=`<h2>Notificaciones</h2><div id="notifList"></div><div class="list-card"><h4>Enviar notificación</h4><textarea id="notifText" placeholder="Mensaje..."></textarea><button class="btn small" onclick="sendNotification()">Enviar</button></div>`; refreshNotifs(); } else { main.innerHTML='<h2>Notificaciones</h2><div id="notifListStudent"></div>'; const list=document.getElementById('notifListStudent'); if(notifications.length===0) list.innerHTML='<p>No hay notificaciones.</p>'; else list.innerHTML=notifications.map(n=>`<div class="list-card"><div class="meta">${new Date(n.createdAt).toLocaleString()}</div><p>${escapeHtml(n.message)}</p></div>`).join(''); }
}
function sendNotification(){ const txt=document.getElementById('notifText').value.trim(); if(!txt) return alert('Escribe mensaje'); notifications.unshift({id:uid(),message:txt,createdAt:new Date().toISOString(),target:'all'}); saveAll(); document.getElementById('notifText').value=''; refreshNotifs(); alert('Notificación enviada'); }
function refreshNotifs(){ const list=document.getElementById('notifList'); if(!list) return; if(notifications.length===0) list.innerHTML='<p>No hay notificaciones.</p>'; else list.innerHTML=notifications.map(n=>`<div class="list-card"><div class="meta">${new Date(n.createdAt).toLocaleString()}</div><p>${escapeHtml(n.message)}</p></div>`).join(''); }

// Boletin
function renderBoletin(){ const main=document.getElementById('mainContent'); main.innerHTML='<h2>Boletín</h2><p>Aquí irán los boletines y comunicados.</p>'; }

// Utilities
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

// page init for reloads or direct load
function initFromReload(){ const role=sessionStorage.getItem('role'); if(role){ document.getElementById('loginView').style.display='none'; document.getElementById('appLayout').style.display='block'; pageInit(); } }
document.addEventListener('DOMContentLoaded', initFromReload);
</script>
</body>
</html>
